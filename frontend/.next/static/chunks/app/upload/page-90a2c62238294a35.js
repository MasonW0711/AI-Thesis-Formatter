(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[676],{8965:function(e,a,s){Promise.resolve().then(s.bind(s,1408))},1408:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return r}});var t=s(3827),i=s(4090),l=s(5313);function r(){var e;let[a,s]=(0,i.useState)("template"),[r,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[o,m]=(0,i.useState)(0),[p,h]=(0,i.useState)(null),[u,x]=(0,i.useState)([]),[g,v]=(0,i.useState)(null),[j,y]=(0,i.useState)(""),[f,b]=(0,i.useState)(null),[D,N]=(0,i.useState)(!1),C=(0,i.useRef)(null),w=(0,l.useRouter)();(0,i.useEffect)(()=>{k()},[]);let k=async()=>{try{let e=await fetch("/api/templates");if(e.ok){let a=await e.json();x(a.templates||[])}}catch(e){console.error("載入範本失敗:",e)}},S=(0,i.useCallback)(e=>{e.preventDefault(),n(!0)},[]),W=(0,i.useCallback)(e=>{e.preventDefault(),n(!1)},[]),B=(0,i.useCallback)(e=>{e.preventDefault(),n(!1);let a=e.dataTransfer.files;a.length>0&&_(a[0])},[a]),I=(0,i.useCallback)(e=>{let a=e.target.files;a&&a.length>0&&_(a[0])},[a]),_=async e=>{let t=e.name.toLowerCase();if(!t.endsWith(".pdf")&&!t.endsWith(".docx")&&!t.endsWith(".doc")){h("只支援 PDF 和 Word (.docx) 格式的文件");return}if(e.size>52428800){h("文件大小不能超過 50MB");return}h(null),c(!0),m(0);let i=new FormData;i.append("file",e);try{let e;let t=setInterval(()=>{m(e=>e>=90?(clearInterval(t),e):e+10)},200);if("template"===a){let a="/api/templates/upload?name=".concat(encodeURIComponent(j||"我的範本"));e=await fetch(a,{method:"POST",body:i})}else e=await fetch("/api/upload",{method:"POST",body:i});if(clearInterval(t),m(100),!e.ok){let a=await e.json();throw Error(a.detail||"上傳失敗")}let l=await e.json();"template"===a?(await k(),v({id:l.id,name:l.name,description:l.description,page_count:l.page_count,created_at:new Date().toISOString()}),s("thesis")):b(l),c(!1)}catch(e){h(e instanceof Error?e.message:"上傳失敗，請稍後再試"),c(!1),m(0)}},E=async()=>{if(f&&g){N(!0),s("processing"),h(null);try{let e=await fetch("/api/documents/".concat(f.id,"/apply-template/").concat(g.id),{method:"POST"});if(!e.ok){let a=await e.json();throw Error(a.detail||"處理失敗")}w.push("/documents")}catch(e){h(e instanceof Error?e.message:"處理失敗，請稍後再試"),N(!1),s("thesis")}}};return(0,t.jsxs)("div",{className:"container",style:{maxWidth:"800px",padding:"2rem 1.5rem"},children:[(0,t.jsx)("h1",{className:"text-center mb-6",children:"論文格式調整"}),(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"1rem",marginBottom:"2rem"},children:[(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",opacity:"template"===a?1:.5},children:[(0,t.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"template"===a?"var(--gradient-primary)":"var(--success-500)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"template"!==a?"✓":"1"}),(0,t.jsx)("span",{children:"上傳範本"})]}),(0,t.jsx)("div",{style:{width:"40px",height:"2px",background:"var(--gray-300)",margin:"auto 0"}}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",opacity:"thesis"===a?1:.5},children:[(0,t.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"thesis"===a?"var(--gradient-primary)":"processing"===a?"var(--success-500)":"var(--gray-300)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"processing"===a?"✓":"2"}),(0,t.jsx)("span",{children:"上傳論文"})]}),(0,t.jsx)("div",{style:{width:"40px",height:"2px",background:"var(--gray-300)",margin:"auto 0"}}),(0,t.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",opacity:"processing"===a?1:.5},children:[(0,t.jsx)("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"processing"===a?"var(--gradient-primary)":"var(--gray-300)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"3"}),(0,t.jsx)("span",{children:"格式調整"})]})]}),p&&(0,t.jsxs)("div",{style:{padding:"1rem",background:"var(--error-500)",color:"white",borderRadius:"var(--radius)",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:["⚠️ ",p]}),"template"===a&&(0,t.jsxs)("div",{className:"card animate-fade-in",children:[(0,t.jsx)("h3",{className:"mb-4",children:"\uD83D\uDCC4 步驟 1：上傳格式範本"}),(0,t.jsx)("p",{style:{color:"var(--gray-500)",marginBottom:"1.5rem"},children:"請上傳一份具有您想要格式的 PDF 文件（例如：學校提供的論文範例）"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"500"},children:"範本名稱"}),(0,t.jsx)("input",{type:"text",value:j,onChange:e=>y(e.target.value),placeholder:"例如：學校論文格式",style:{width:"100%",padding:"0.75rem 1rem",border:"1px solid var(--gray-300)",borderRadius:"var(--radius)",fontSize:"1rem"}})]}),u.length>0&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{style:{marginBottom:"0.75rem"},children:"或選擇已有的範本："}),(0,t.jsx)("div",{className:"template-grid",children:u.map(e=>(0,t.jsxs)("div",{className:"template-card ".concat((null==g?void 0:g.id)===e.id?"selected":""),onClick:()=>{v(e),s("thesis")},children:[(0,t.jsxs)("div",{className:"template-name",children:["\uD83D\uDCDA ",e.name]}),(0,t.jsx)("div",{className:"template-description",children:e.description})]},e.id))})]}),(0,t.jsxs)("div",{className:"upload-zone ".concat(r?"drag-over":""),onDragOver:S,onDragLeave:W,onDrop:B,onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},children:[(0,t.jsx)("input",{ref:C,type:"file",accept:".pdf,.docx,.doc",onChange:I,style:{display:"none"}}),d?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"upload-icon animate-spin",children:"\uD83D\uDCE4"}),(0,t.jsx)("h3",{className:"upload-title",children:"正在上傳並學習格式..."}),(0,t.jsx)("div",{className:"progress-bar",style:{maxWidth:"300px",margin:"1rem auto"},children:(0,t.jsx)("div",{className:"progress-fill",style:{width:"".concat(o,"%")}})})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"upload-icon",children:"\uD83D\uDCC4"}),(0,t.jsx)("h3",{className:"upload-title",children:"上傳格式範本"}),(0,t.jsx)("p",{className:"upload-subtitle",children:"支援 PDF 或 Word (.docx)"})]})]})]}),"thesis"===a&&g&&(0,t.jsxs)("div",{className:"card animate-fade-in",children:[(0,t.jsx)("h3",{className:"mb-4",children:"\uD83D\uDCDD 步驟 2：上傳您的論文"}),(0,t.jsxs)("div",{style:{padding:"1rem",background:"var(--primary-50)",borderRadius:"var(--radius)",marginBottom:"1.5rem"},children:[(0,t.jsxs)("div",{style:{fontWeight:"600",marginBottom:"0.25rem"},children:["已選擇範本：",g.name]}),(0,t.jsx)("div",{style:{fontSize:"0.875rem",color:"var(--gray-500)"},children:g.description})]}),f?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"file-item",style:{marginBottom:"1.5rem"},children:[(0,t.jsx)("div",{className:"file-icon",children:f.filename.toLowerCase().endsWith(".pdf")?"PDF":"DOCX"}),(0,t.jsxs)("div",{className:"file-info",children:[(0,t.jsx)("div",{className:"file-name",children:f.filename}),(0,t.jsxs)("div",{className:"file-meta",children:[(e=f.file_size)<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):"".concat((e/1048576).toFixed(1)," MB")," \xb7 ",f.page_count," 頁"]})]}),(0,t.jsx)("span",{className:"status-badge status-uploaded",children:"已上傳"})]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[(0,t.jsx)("button",{className:"btn btn-secondary",onClick:()=>{b(null),m(0)},children:"重新上傳"}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:E,disabled:D,children:D?"處理中...":"開始套用格式 →"})]})]}):(0,t.jsxs)("div",{className:"upload-zone ".concat(r?"drag-over":""),onDragOver:S,onDragLeave:W,onDrop:B,onClick:()=>{var e;return null===(e=C.current)||void 0===e?void 0:e.click()},children:[(0,t.jsx)("input",{ref:C,type:"file",accept:".pdf,.docx,.doc",onChange:I,style:{display:"none"}}),d?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"upload-icon animate-spin",children:"\uD83D\uDCE4"}),(0,t.jsx)("h3",{className:"upload-title",children:"正在上傳論文..."}),(0,t.jsx)("div",{className:"progress-bar",style:{maxWidth:"300px",margin:"1rem auto"},children:(0,t.jsx)("div",{className:"progress-fill",style:{width:"".concat(o,"%")}})})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"upload-icon",children:"\uD83D\uDCDD"}),(0,t.jsx)("h3",{className:"upload-title",children:"上傳您的論文"}),(0,t.jsx)("p",{className:"upload-subtitle",children:"支援 PDF 或 Word (.docx)"})]})]}),(0,t.jsx)("button",{className:"btn btn-secondary mt-4",onClick:()=>{s("template"),v(null)},style:{width:"100%"},children:"← 返回選擇範本"})]}),"processing"===a&&(0,t.jsxs)("div",{className:"card animate-fade-in text-center",style:{padding:"3rem 2rem"},children:[(0,t.jsx)("div",{style:{fontSize:"4rem"},className:"animate-spin",children:"⚙️"}),(0,t.jsx)("h3",{className:"mt-4",children:"正在套用格式..."}),(0,t.jsx)("p",{style:{color:"var(--gray-500)"},children:"系統正在根據範本調整您的論文格式，請稍候"})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=8965)}),_N_E=e.O()}]);