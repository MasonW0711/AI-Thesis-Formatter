(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[479],{4603:function(e,t,a){Promise.resolve().then(a.bind(a,7900))},7900:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var s=a(3827),n=a(4090),i=a(8792);function l(){let[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)(!0),[r,c]=(0,n.useState)(null),d=(0,n.useCallback)(async()=>{try{let e=await fetch("/api/documents");if(!e.ok)throw Error("獲取文件列表失敗");let a=await e.json();t(a.documents),c(null)}catch(e){c(e instanceof Error?e.message:"載入失敗")}finally{l(!1)}},[]);(0,n.useEffect)(()=>{d();let e=setInterval(d,5e3);return()=>clearInterval(e)},[d]);let o=async e=>{try{let t=await fetch("/api/documents/".concat(e.id,"/download"));if(!t.ok){let e=await t.json();throw Error(e.detail||"下載失敗")}let a=await t.blob(),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download="格式調整_".concat(e.filename),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(s),document.body.removeChild(n)}catch(e){alert(e instanceof Error?e.message:"下載失敗")}},m=async e=>{if(confirm("確定要刪除「".concat(e.filename,"」嗎？")))try{if(!(await fetch("/api/documents/".concat(e.id),{method:"DELETE"})).ok)throw Error("刪除失敗");d()}catch(e){alert(e instanceof Error?e.message:"刪除失敗")}},u=e=>e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):"".concat((e/1048576).toFixed(1)," MB"),h=e=>new Date(e).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),f=e=>{let t={uploaded:{label:"已上傳",class:"status-uploaded"},processing:{label:"處理中",class:"status-processing"},completed:{label:"已完成",class:"status-completed"},failed:{label:"處理失敗",class:"status-failed"}}[e]||{label:e,class:"status-uploaded"};return(0,s.jsx)("span",{className:"status-badge ".concat(t.class),children:t.label})};return(0,s.jsxs)("div",{className:"container",style:{maxWidth:"900px",padding:"2rem 1.5rem"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[(0,s.jsx)("h1",{children:"我的文件"}),(0,s.jsx)(i.default,{href:"/upload",className:"btn btn-primary",children:"\uD83D\uDCE4 上傳新文件"})]}),r&&(0,s.jsxs)("div",{style:{padding:"1rem",background:"var(--error-500)",color:"white",borderRadius:"var(--radius)",marginBottom:"1.5rem"},children:["⚠️ ",r]}),a&&(0,s.jsxs)("div",{className:"text-center",style:{padding:"4rem 0"},children:[(0,s.jsx)("div",{style:{fontSize:"3rem"},className:"animate-spin",children:"⏳"}),(0,s.jsx)("p",{style:{marginTop:"1rem",color:"var(--gray-500)"},children:"載入中..."})]}),!a&&0===e.length&&(0,s.jsxs)("div",{className:"card text-center",style:{padding:"4rem 2rem"},children:[(0,s.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"\uD83D\uDCED"}),(0,s.jsx)("h3",{children:"尚無文件"}),(0,s.jsx)("p",{style:{color:"var(--gray-500)",marginBottom:"2rem"},children:"上傳您的第一份論文，開始使用格式調整功能"}),(0,s.jsx)(i.default,{href:"/upload",className:"btn btn-primary",children:"上傳論文"})]}),!a&&e.length>0&&(0,s.jsx)("div",{className:"file-list",children:e.map(e=>(0,s.jsxs)("div",{className:"file-item animate-fade-in",children:[(0,s.jsx)("div",{className:"file-icon",children:"PDF"}),(0,s.jsxs)("div",{className:"file-info",children:[(0,s.jsx)("div",{className:"file-name",children:e.filename}),(0,s.jsxs)("div",{className:"file-meta",children:[u(e.file_size)," \xb7 ",e.page_count," 頁 \xb7 ",h(e.created_at)]})]}),f(e.status),(0,s.jsxs)("div",{className:"file-actions",children:["completed"===e.status&&(0,s.jsx)("button",{className:"btn btn-success",onClick:()=>o(e),style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"\uD83D\uDCE5 下載"}),(0,s.jsx)("button",{className:"btn btn-secondary",onClick:()=>m(e),style:{padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"\uD83D\uDDD1️"})]})]},e.id))})]})}}},function(e){e.O(0,[792,971,69,744],function(){return e(e.s=4603)}),_N_E=e.O()}]);